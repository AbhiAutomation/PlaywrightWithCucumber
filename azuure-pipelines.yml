- task: PowerShell@2
  enabled: true
  displayName: "Install dependencies"
  inputs:
    targetType: 'inline'
    script: 'npm ci'
    workingDirectory: tests/ # update accordingly

- task: AzureCLI@2
  displayName: Run Playwright Test  
  env:
  PLAYWRIGHT_SERVICE_URL: wss://eastasia.api.playwright.microsoft.com/accounts/eastasia_08a4574b-40a0-40f7-9580-97baad9731c5/browsers
    # PLAYWRIGHT_SERVICE_ACCESS_TOKEN: $(PLAYWRIGHT_SERVICE_ACCESS_TOKEN) # Not recommended, use Microsoft Entra ID authentication. 

  inputs:
    azureSubscription: '11' # Service connection used to authenticate this pipeline with Azure to use the service
    scriptType: 'pscore'
    scriptLocation: 'inlineScript'
    inlineScript: |
      npx playwright test -c playwright.service.config.ts --workers=20
  addSpnToEnvironment: true
  workingDirectory: path/to/playwright/folder # update accordingly

- task: PublishPipelineArtifact@1
  displayName: Upload Playwright report
  inputs:
    targetPath: tests/playwright-report/ # update accordingly
    artifact: 'Playwright tests'
    publishLocation: 'pipeline'